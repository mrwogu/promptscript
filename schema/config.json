{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://getpromptscript.dev/latest/schema/config.json",
  "title": "PromptScript Configuration",
  "description": "PromptScript configuration file (promptscript.yaml).",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "const": "1",
      "description": "Config version"
    },
    "extends": {
      "type": "string",
      "description": "Extend another configuration file. Paths are resolved relative to the current config file.",
      "example": "extends: '../base-config.yaml'"
    },
    "project": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "team": {
          "type": "string"
        }
      },
      "required": [
        "id"
      ],
      "additionalProperties": false,
      "description": "Project identification"
    },
    "inherit": {
      "type": "string",
      "description": "Inheritance path"
    },
    "input": {
      "type": "object",
      "properties": {
        "entry": {
          "type": "string",
          "description": "Entry file path (defaults to '.promptscript/project.prs')"
        },
        "include": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Glob patterns for additional files to include"
        },
        "exclude": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Glob patterns for files to exclude"
        }
      },
      "additionalProperties": false,
      "description": "Input file configuration. Controls which PromptScript files to compile."
    },
    "registry": {
      "type": "object",
      "properties": {
        "path": {
          "type": "string",
          "description": "Local path to registry"
        },
        "url": {
          "type": "string",
          "description": "Remote URL (HTTP registry)"
        },
        "git": {
          "type": "object",
          "properties": {
            "url": {
              "type": "string",
              "description": "Git repository URL (HTTPS or SSH)"
            },
            "ref": {
              "type": "string",
              "description": "Git ref to checkout (branch, tag, or commit hash).",
              "default": "main"
            },
            "path": {
              "type": "string",
              "description": "Subdirectory within the repository to use as registry root.",
              "examples": [
                "registry/"
              ],
              "example": "registry/"
            },
            "auth": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "token",
                    "ssh"
                  ],
                  "description": "Authentication type.\n- 'token': Use a personal access token (PAT)\n- 'ssh': Use SSH key authentication"
                },
                "token": {
                  "type": "string",
                  "description": "Personal access token (for token auth)"
                },
                "tokenEnvVar": {
                  "type": "string",
                  "description": "Environment variable containing the token"
                },
                "sshKeyPath": {
                  "type": "string",
                  "description": "Path to SSH key (for SSH auth).",
                  "default": "~/.ssh/id_rsa"
                }
              },
              "required": [
                "type"
              ],
              "additionalProperties": false,
              "description": "Authentication options for private repositories"
            }
          },
          "required": [
            "url"
          ],
          "additionalProperties": false,
          "description": "Git repository configuration. When specified, the registry will be cloned from a Git repository."
        },
        "cache": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether caching is enabled"
            },
            "ttl": {
              "type": "number",
              "description": "Cache TTL in milliseconds"
            }
          },
          "additionalProperties": false,
          "description": "Cache settings"
        },
        "auth": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "bearer",
                "basic"
              ],
              "description": "Authentication type"
            },
            "token": {
              "type": "string",
              "description": "Token for bearer auth, or \"username:password\" for basic auth"
            },
            "tokenEnvVar": {
              "type": "string",
              "description": "Environment variable containing the token (alternative to token)"
            }
          },
          "required": [
            "type"
          ],
          "additionalProperties": false,
          "description": "Authentication for HTTP registries"
        }
      },
      "additionalProperties": false,
      "description": "Registry configuration"
    },
    "watch": {
      "type": "object",
      "properties": {
        "include": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Glob patterns for files to watch (defaults to '**\\/*.prs')"
        },
        "exclude": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Glob patterns for files to ignore"
        },
        "debounce": {
          "type": "number",
          "description": "Debounce time in milliseconds before recompiling"
        },
        "clearScreen": {
          "type": "boolean",
          "description": "Clear screen before each recompilation"
        }
      },
      "additionalProperties": false,
      "description": "Watch mode configuration. Settings for `prs compile --watch`."
    },
    "output": {
      "type": "object",
      "properties": {
        "baseDir": {
          "type": "string",
          "description": "Base directory for all output files"
        },
        "header": {
          "type": "string",
          "description": "Custom header to prepend to generated files"
        },
        "overwrite": {
          "type": "boolean",
          "description": "Whether to overwrite existing files without warning"
        }
      },
      "additionalProperties": false,
      "description": "Output configuration. Global output settings applied to all targets."
    },
    "targets": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/TargetEntry"
      },
      "description": "Output targets.\n\nCan be simple names or objects with configuration:",
      "example": "targets:\n  - github\n  - claude:\n      convention: markdown\n      output: custom/CLAUDE.md"
    },
    "customConventions": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/OutputConvention"
      },
      "description": "Custom convention definitions. Register custom conventions that can be referenced by name in targets."
    },
    "validation": {
      "type": "object",
      "properties": {
        "requiredGuards": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "rules": {
          "type": "object",
          "additionalProperties": {
            "type": "string",
            "enum": [
              "error",
              "warning",
              "off"
            ]
          }
        }
      },
      "additionalProperties": false,
      "description": "Validation settings"
    }
  },
  "required": [
    "version",
    "project",
    "registry",
    "targets"
  ],
  "additionalProperties": false,
  "definitions": {
    "TargetEntry": {
      "anyOf": [
        {
          "$ref": "#/definitions/TargetName"
        },
        {
          "type": "object",
          "properties": {
            "github": {
              "$ref": "#/definitions/TargetConfig"
            },
            "claude": {
              "$ref": "#/definitions/TargetConfig"
            },
            "cursor": {
              "$ref": "#/definitions/TargetConfig"
            },
            "gemini": {
              "$ref": "#/definitions/TargetConfig"
            },
            "jetbrains": {
              "$ref": "#/definitions/TargetConfig"
            }
          },
          "additionalProperties": {
            "$ref": "#/definitions/TargetConfig"
          }
        }
      ],
      "description": "Target can be a simple string name or a full configuration object."
    },
    "TargetName": {
      "type": "string",
      "description": "Supported output targets.q"
    },
    "TargetConfig": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether this target is enabled.",
          "default": true
        },
        "output": {
          "type": "string",
          "description": "Custom output path for this target."
        },
        "convention": {
          "$ref": "#/definitions/ConventionName",
          "description": "Output convention ('xml', 'markdown', or custom name)."
        },
        "version": {
          "type": "string",
          "description": "Target version or format variant. Use 'legacy' for deprecated formats (e.g., Cursor's .cursorrules).",
          "example": "'legacy' | '1.0' | '2.0'"
        }
      },
      "additionalProperties": false,
      "description": "Configuration for a single target."
    },
    "ConventionName": {
      "anyOf": [
        {
          "$ref": "#/definitions/BuiltInConventionName"
        },
        {
          "type": "string"
        }
      ],
      "description": "Convention name (built-in or custom)."
    },
    "BuiltInConventionName": {
      "type": "string",
      "enum": [
        "xml",
        "markdown"
      ],
      "description": "Built-in convention names."
    },
    "OutputConvention": {
      "type": "object",
      "properties": {
        "name": {
          "$ref": "#/definitions/ConventionName",
          "description": "Convention identifier."
        },
        "description": {
          "type": "string",
          "description": "Human-readable description."
        },
        "section": {
          "$ref": "#/definitions/SectionRenderer",
          "description": "Section rendering configuration."
        },
        "subsection": {
          "$ref": "#/definitions/SectionRenderer",
          "description": "Subsection rendering (defaults to section config if not specified)."
        },
        "listStyle": {
          "type": "string",
          "enum": [
            "dash",
            "asterisk",
            "bullet",
            "numbered"
          ],
          "description": "How to render lists.",
          "default": "'dash' (- item)"
        },
        "codeBlockDelimiter": {
          "type": "string",
          "description": "Code block delimiter.",
          "default": "```"
        },
        "rootWrapper": {
          "type": "object",
          "properties": {
            "start": {
              "type": "string"
            },
            "end": {
              "type": "string"
            }
          },
          "required": [
            "start",
            "end"
          ],
          "additionalProperties": false,
          "description": "Whether to wrap content in a root element."
        }
      },
      "required": [
        "name",
        "section"
      ],
      "additionalProperties": false,
      "description": "Output convention definition."
    },
    "SectionRenderer": {
      "type": "object",
      "properties": {
        "start": {
          "type": "string",
          "description": "Template for section start. Variables: {{name}}, {{level}}, {{content}}",
          "example": "Markdown: \"{{#repeat level}}#{{/repeat}} {{name}}\""
        },
        "end": {
          "type": "string",
          "description": "Template for section end (optional, for paired tags). Variables: {{name}}",
          "example": "Markdown: \"\" (empty - no closing tag)"
        },
        "nameTransform": {
          "type": "string",
          "enum": [
            "kebab-case",
            "camelCase",
            "PascalCase",
            "none"
          ],
          "description": "Whether to convert section names.",
          "default": "kebab-case"
        },
        "indent": {
          "type": "string",
          "description": "Indentation per level.",
          "default": "'  ' (2 spaces)"
        }
      },
      "required": [
        "start"
      ],
      "additionalProperties": false,
      "description": "Section rendering configuration."
    }
  }
}
